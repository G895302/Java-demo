# Application.properties

# ✅ Application Settings
# ========================
spring.application.name=demo
server.port=8080

# ==========================
# ✅ Remote PostgreSQL DB
# ==========================
spring.datasource.driver-class-name=org.postgresql.Driver

spring.jpa.properties.hibernate.jdbc.time_zone=Asia/Kolkata

spring.datasource.url=jdbc:postgresql://157.173.221.238:5432/studentdb
spring.datasource.username=postgres
spring.datasource.password=root

# ========================
# ✅ HikariCP Pooling
# ========================
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.maximum-pool-size=5

# ========================
# ✅ JPA & Hibernate
# ========================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.show-sql=true
spring.jpa.generate-ddl=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.time_zone=Asia/Kolkata

# Enable JPA repositories
spring.data.jpa.repositories.bootstrap-mode=default
spring.jackson.serialization.fail-on-empty-beans=false
spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true

#2. JDBC Utility Class (Connection Handling)
package com.demo.javabasic;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class DBConnection {

    // --- LOCAL PostgreSQL (use this if pgAdmin shows local server) ---
    private static final String URL = "jdbc:postgresql://localhost:5432/studentdb";

    // --- REMOTE PostgreSQL (use this instead if you want the remote host) ---
    // private static final String URL = "jdbc:postgresql://157.173.221.238:5432/studentdb";

    private static final String USER = "postgres";
    private static final String PASSWORD = "root"; // change to the actual password you use in pgAdmin

    public static Connection getConnection() throws SQLException {
        return DriverManager.getConnection(URL, USER, PASSWORD);
    }
}

#3. CRUD Operations Using PreparedStatement
package com.demo.javabasic;

import java.sql.*;

public class StudentCRUD {

    // INSERT
    public static void insertStudent(String name, String email, int age) {
        String sql = "INSERT INTO students (name, email, age) VALUES (?, ?, ?)";

        try (Connection con = DBConnection.getConnection();
             PreparedStatement ps = con.prepareStatement(sql)) {

            ps.setString(1, name);
            ps.setString(2, email);
            ps.setInt(3, age);

            ps.executeUpdate();
            System.out.println("Student inserted successfully.");

        } catch (SQLException e) {
            System.out.println("Insert Error: " + e.getMessage());
        }
    }

    // READ
    public static void getAllStudents() {
        String sql = "SELECT * FROM students";

        try (Connection con = DBConnection.getConnection();
             PreparedStatement ps = con.prepareStatement(sql);
             ResultSet rs = ps.executeQuery()) {

            System.out.println("\nID | Name | Email | Age");

            while (rs.next()) {
                System.out.println(
                        rs.getInt("id") + " | " +
                        rs.getString("name") + " | " +
                        rs.getString("email") + " | " +
                        rs.getInt("age")
                );
            }

        } catch (SQLException e) {
            System.out.println("Read Error: " + e.getMessage());
        }
    }

    // UPDATE
    public static void updateStudent(int id, int age) {
        String sql = "UPDATE students SET age = ? WHERE id = ?";

        try (Connection con = DBConnection.getConnection();
             PreparedStatement ps = con.prepareStatement(sql)) {

            ps.setInt(1, age);
            ps.setInt(2, id);

            int rows = ps.executeUpdate();

            if (rows > 0)
                System.out.println("Student updated successfully.");
            else
                System.out.println("Student not found.");

        } catch (SQLException e) {
            System.out.println("Update Error: " + e.getMessage());
        }
    }

    // DELETE
    public static void deleteStudent(int id) {
        String sql = "DELETE FROM students WHERE id = ?";

        try (Connection con = DBConnection.getConnection();
             PreparedStatement ps = con.prepareStatement(sql)) {

            ps.setInt(1, id);

            int rows = ps.executeUpdate();

            if (rows > 0)
                System.out.println("Student deleted successfully.");
            else
                System.out.println("Student not found.");

        } catch (SQLException e) {
            System.out.println("Delete Error: " + e.getMessage());
        }
    }
}

#4.Main Class (Run the Program)
package com.demo.javabasic;

public class Main1 {
    public static void main(String[] args) {

        StudentCRUD.insertStudent("Gauri", "gauri@gmail.com", 22);
        StudentCRUD.insertStudent("Amit", "amit@gmail.com", 24);

        StudentCRUD.getAllStudents();

        StudentCRUD.updateStudent(1, 25);

        StudentCRUD.deleteStudent(2);

        StudentCRUD.getAllStudents();
    }
}

#5. test Connection
package com.demo.javabasic;

import java.sql.Connection;

public class TestConnection {
    public static void main(String[] args) {
        try (Connection con = DBConnection.getConnection()) {
            if (con != null && !con.isClosed()) {
                System.out.println("Connected Successfully!");
            } else {
                System.out.println("Connection failed or closed.");
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

